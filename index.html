<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„É¢„Éê„Ç§„É´„Éö„Éº„Ç∏ „Ç®„Éá„Ç£„Çø</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0f1117;
            --bg-secondary: #1a1d27;
            --bg-tertiary: #242836;
            --bg-hover: #2d3244;
            --text-primary: #e8eaf0;
            --text-secondary: #9ca3b4;
            --text-muted: #636b80;
            --accent: #6c8aff;
            --accent-hover: #8ba3ff;
            --accent-dim: rgba(108, 138, 255, 0.12);
            --border: #2a2e3d;
            --danger: #ff6b6b;
            --success: #51cf66;
            --warning: #ffd43b;
            --radius: 8px;
            --radius-lg: 12px;
            --shadow: 0 4px 24px rgba(0,0,0,0.3);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Noto Sans JP', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
        }

        /* ===== LAYOUT ===== */
        .app {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        .toolbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 16px;
            height: 52px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            flex-shrink: 0;
        }

        .toolbar-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .toolbar-logo {
            font-size: 15px;
            font-weight: 700;
            color: var(--accent);
            letter-spacing: -0.02em;
        }

        .toolbar-logo span { color: var(--text-muted); font-weight: 400; }

        .toolbar-actions {
            display: flex;
            gap: 8px;
        }

        .main-area {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* ===== SIDEBAR ===== */
        .sidebar {
            width: 360px;
            min-width: 360px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .sidebar-tabs {
            display: flex;
            border-bottom: 1px solid var(--border);
            flex-shrink: 0;
        }

        .sidebar-tab {
            flex: 1;
            padding: 12px 8px;
            text-align: center;
            font-size: 12px;
            font-weight: 500;
            color: var(--text-muted);
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
        }

        .sidebar-tab:hover { color: var(--text-secondary); }
        .sidebar-tab.active {
            color: var(--accent);
            border-bottom-color: var(--accent);
        }

        .sidebar-content {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }

        .sidebar-content::-webkit-scrollbar { width: 4px; }
        .sidebar-content::-webkit-scrollbar-track { background: transparent; }
        .sidebar-content::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }

        .sidebar-panel { display: none; }
        .sidebar-panel.active { display: block; }

        /* ===== FORM ELEMENTS ===== */
        .section {
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--text-muted);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .field {
            margin-bottom: 12px;
        }

        .field-label {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 5px;
            display: block;
        }

        input[type="text"], input[type="number"], textarea, select {
            width: 100%;
            padding: 8px 12px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            color: var(--text-primary);
            font-size: 13px;
            font-family: 'Noto Sans JP', sans-serif;
            outline: none;
            transition: border-color 0.2s;
        }

        input:focus, textarea:focus, select:focus {
            border-color: var(--accent);
        }

        textarea { resize: vertical; min-height: 60px; }

        input[type="color"] {
            width: 36px;
            height: 36px;
            padding: 2px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            cursor: pointer;
        }

        .color-row {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .color-row input[type="text"] { flex: 1; }

        .btn {
            padding: 8px 16px;
            border-radius: var(--radius);
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            border: none;
            transition: all 0.15s;
            font-family: 'Noto Sans JP', sans-serif;
        }

        .btn-primary {
            background: var(--accent);
            color: white;
        }
        .btn-primary:hover { background: var(--accent-hover); }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }
        .btn-secondary:hover { background: var(--bg-hover); }

        .btn-danger {
            background: rgba(255, 107, 107, 0.15);
            color: var(--danger);
            border: 1px solid rgba(255, 107, 107, 0.2);
        }
        .btn-danger:hover { background: rgba(255, 107, 107, 0.25); }

        .btn-success {
            background: var(--success);
            color: #1a1d27;
        }
        .btn-success:hover { opacity: 0.9; }

        .btn-sm { padding: 5px 10px; font-size: 11px; }
        .btn-block { width: 100%; }

        .btn-row {
            display: flex;
            gap: 6px;
            margin-top: 8px;
        }

        /* ===== EDITABLE LIST ===== */
        .edit-list { display: flex; flex-direction: column; gap: 6px; }

        .edit-list-item {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 10px;
            background: var(--bg-tertiary);
            border-radius: var(--radius);
            border: 1px solid var(--border);
            cursor: pointer;
            transition: all 0.15s;
        }

        .edit-list-item:hover { border-color: var(--accent); }
        .edit-list-item.selected { border-color: var(--accent); background: var(--accent-dim); }

        .edit-list-item .item-label {
            flex: 1;
            font-size: 13px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .edit-list-item .item-badge {
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
            background: var(--accent-dim);
            color: var(--accent);
        }

        .edit-list-item .item-delete {
            width: 22px;
            height: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            font-size: 14px;
            color: var(--text-muted);
            cursor: pointer;
            flex-shrink: 0;
        }
        .edit-list-item .item-delete:hover { color: var(--danger); background: rgba(255,107,107,0.1); }

        /* ===== DETAIL PANEL ===== */
        .detail-panel {
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 16px;
            margin-top: 12px;
        }

        .detail-panel-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 14px;
        }

        .detail-panel-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
        }

        /* ===== GRADIENT PICKER ===== */
        .gradient-preview {
            width: 100%;
            height: 40px;
            border-radius: var(--radius);
            margin-bottom: 8px;
            border: 1px solid var(--border);
        }

        .gradient-colors {
            display: flex;
            gap: 8px;
        }

        .gradient-colors .color-group {
            flex: 1;
        }

        .gradient-colors .color-group label {
            font-size: 11px;
            color: var(--text-muted);
            display: block;
            margin-bottom: 4px;
        }

        /* ===== PREVIEW ===== */
        .preview-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: #1e2028;
            padding: 20px;
            overflow: auto;
        }

        .preview-frame-wrapper {
            width: 390px;
            height: 100%;
            max-height: 844px;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: var(--shadow), 0 0 0 1px rgba(255,255,255,0.05);
            position: relative;
            background: white;
        }

        .preview-frame-wrapper iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        .device-label {
            font-size: 11px;
            color: var(--text-muted);
            margin-top: 10px;
            text-align: center;
        }

        /* ===== EMOJI PICKER ===== */
        .emoji-picker-trigger {
            width: 40px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            cursor: pointer;
            font-size: 18px;
            flex-shrink: 0;
        }

        .emoji-grid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 4px;
            padding: 8px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            margin-top: 6px;
        }

        .emoji-grid span {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border-radius: 4px;
            font-size: 16px;
        }
        .emoji-grid span:hover { background: var(--bg-hover); }

        /* ===== PRESET COLORS ===== */
        .preset-colors {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            margin-top: 8px;
        }

        .preset-color {
            width: 28px;
            height: 28px;
            border-radius: 6px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.15s;
        }

        .preset-color:hover { transform: scale(1.1); }
        .preset-color.selected { border-color: white; }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 900px) {
            .sidebar { width: 300px; min-width: 300px; }
        }

        /* ===== SCROLLBAR ===== */
        .preview-area::-webkit-scrollbar { width: 6px; }
        .preview-area::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }

        .tab-drag-handle {
            cursor: grab;
            color: var(--text-muted);
            font-size: 12px;
            padding: 0 2px;
        }
    </style>
</head>
<body>
<div class="app">
    <!-- TOOLBAR -->
    <div class="toolbar">
        <div class="toolbar-left">
            <div class="toolbar-logo">PageForge <span>Editor</span></div>
        </div>
        <div class="toolbar-actions">
            <button class="btn btn-secondary btn-sm" onclick="resetAll()">„É™„Çª„ÉÉ„Éà</button>
            <button class="btn btn-secondary btn-sm" onclick="importJSON()">„Ç§„É≥„Éù„Éº„Éà</button>
            <button class="btn btn-secondary btn-sm" onclick="exportJSON()">JSON‰øùÂ≠ò</button>
            <button class="btn btn-success btn-sm" onclick="exportHTML()">HTML„Ç®„ÇØ„Çπ„Éù„Éº„Éà ‚Üì</button>
        </div>
    </div>

    <div class="main-area">
        <!-- SIDEBAR -->
        <div class="sidebar">
            <div class="sidebar-tabs">
                <div class="sidebar-tab active" data-panel="header">„Éò„ÉÉ„ÉÄ„Éº</div>
                <div class="sidebar-tab" data-panel="tabs">„Çø„Éñ</div>
                <div class="sidebar-tab" data-panel="content">„Ç≥„É≥„ÉÜ„É≥„ÉÑ</div>
                <div class="sidebar-tab" data-panel="style">„Çπ„Çø„Ç§„É´</div>
            </div>

            <div class="sidebar-content">
                <!-- HEADER PANEL -->
                <div class="sidebar-panel active" id="panel-header">
                    <div class="section">
                        <div class="section-title">üìù „Éò„ÉÉ„ÉÄ„Éº„Çø„Ç§„Éà„É´</div>
                        <div class="field">
                            <label class="field-label">„Çø„Ç§„Éà„É´„ÉÜ„Ç≠„Çπ„Éà</label>
                            <input type="text" id="headerTitle" value="Ë¶ãÂá∫„Åó" oninput="updatePreview()">
                        </div>
                        <div class="field">
                            <label class="field-label">„Éï„Ç©„É≥„Éà„Çµ„Ç§„Ç∫ (px)</label>
                            <input type="number" id="headerFontSize" value="60" min="20" max="200" oninput="updatePreview()">
                        </div>
                        <div class="field">
                            <label class="field-label">ÊñáÂ≠ó„ÅÆÂêë„Åç</label>
                            <select id="headerWritingMode" onchange="updatePreview()">
                                <option value="vertical-rl">Á∏¶Êõ∏„ÅçÔºàÂè≥‚ÜíÂ∑¶Ôºâ</option>
                                <option value="horizontal-tb">Ê®™Êõ∏„Åç</option>
                            </select>
                        </div>
                    </div>
                    <div class="section">
                        <div class="section-title">üé® „Éò„ÉÉ„ÉÄ„ÉºËÉåÊôØ</div>
                        <div class="field">
                            <label class="field-label">„Ç∞„É©„Éá„Éº„Ç∑„Éß„É≥ „Éó„É¨„Éì„É•„Éº</label>
                            <div class="gradient-preview" id="headerGradientPreview"></div>
                            <div class="gradient-colors">
                                <div class="color-group">
                                    <label>ÈñãÂßãËâ≤</label>
                                    <div class="color-row">
                                        <input type="color" id="headerColor1" value="#667eea" oninput="updatePreview()">
                                        <input type="text" id="headerColor1Text" value="#667eea" oninput="syncColor('headerColor1', this.value); updatePreview()">
                                    </div>
                                </div>
                                <div class="color-group">
                                    <label>ÁµÇ‰∫ÜËâ≤</label>
                                    <div class="color-row">
                                        <input type="color" id="headerColor2" value="#764ba2" oninput="updatePreview()">
                                        <input type="text" id="headerColor2Text" value="#764ba2" oninput="syncColor('headerColor2', this.value); updatePreview()">
                                    </div>
                                </div>
                            </div>
                            <div class="field" style="margin-top: 8px;">
                                <label class="field-label">„Ç∞„É©„Éá„Éº„Ç∑„Éß„É≥ËßíÂ∫¶ (deg)</label>
                                <input type="number" id="headerGradientAngle" value="135" min="0" max="360" oninput="updatePreview()">
                            </div>
                        </div>
                        <div class="field">
                            <label class="field-label">„Éó„É™„Çª„ÉÉ„Éà</label>
                            <div class="preset-colors" id="headerPresets"></div>
                        </div>
                    </div>
                    <div class="section">
                        <div class="section-title">üìê „Éò„ÉÉ„ÉÄ„Éº„Çµ„Ç§„Ç∫</div>
                        <div class="field">
                            <label class="field-label">„Ç¢„Çπ„Éö„ÇØ„ÉàÊØîÔºàÈ´ò„Åï = ÂπÖ √ó ?Ôºâ</label>
                            <select id="headerAspect" onchange="updatePreview()">
                                <option value="0.5625">9:16</option>
                                <option value="0.75" selected>3:4</option>
                                <option value="1">1:1</option>
                                <option value="0.5">1:2</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- TABS PANEL -->
                <div class="sidebar-panel" id="panel-tabs">
                    <div class="section">
                        <div class="section-title">üìë „É°„Ç§„É≥„Çø„Éñ</div>
                        <div class="edit-list" id="mainTabsList"></div>
                        <div class="btn-row">
                            <button class="btn btn-primary btn-sm" onclick="addMainTab()">Ôºã „Çø„ÉñËøΩÂä†</button>
                        </div>
                    </div>

                    <div id="mainTabDetail"></div>
                </div>

                <!-- CONTENT PANEL -->
                <div class="sidebar-panel" id="panel-content">
                    <div class="section">
                        <div class="section-title">üìã „Ç≥„É≥„ÉÜ„É≥„ÉÑÁ∑®ÈõÜ</div>
                        <div class="field">
                            <label class="field-label">„É°„Ç§„É≥„Çø„Éñ„ÇíÈÅ∏Êäû</label>
                            <select id="contentMainTabSelect" onchange="onContentMainTabChange()"></select>
                        </div>
                        <div class="field">
                            <label class="field-label">„Çµ„Éñ„Çø„Éñ„ÇíÈÅ∏Êäû</label>
                            <select id="contentSubTabSelect" onchange="onContentSubTabChange()"></select>
                        </div>
                    </div>

                    <div id="contentEditor"></div>
                </div>

                <!-- STYLE PANEL -->
                <div class="sidebar-panel" id="panel-style">
                    <div class="section">
                        <div class="section-title">üéØ „Ç¢„ÇØ„Çª„É≥„Éà„Ç´„É©„Éº</div>
                        <div class="field">
                            <div class="color-row">
                                <input type="color" id="accentColor" value="#667eea" oninput="updatePreview()">
                                <input type="text" id="accentColorText" value="#667eea" oninput="syncColor('accentColor', this.value); updatePreview()">
                            </div>
                        </div>
                    </div>
                    <div class="section">
                        <div class="section-title">üî§ „Éï„Ç©„É≥„Éà</div>
                        <div class="field">
                            <label class="field-label">„Éï„Ç©„É≥„Éà„Éï„Ç°„Éü„É™„Éº</label>
                            <select id="fontFamily" onchange="updatePreview()">
                                <option value="'Hiragino Mincho ProN', 'Yu Mincho', serif">ÊòéÊúù‰Ωì</option>
                                <option value="'Hiragino Kaku Gothic ProN', 'Yu Gothic', sans-serif">„Ç¥„Ç∑„ÉÉ„ÇØ‰Ωì</option>
                                <option value="'Noto Sans JP', sans-serif">Noto Sans JP</option>
                                <option value="'Noto Serif JP', serif">Noto Serif JP</option>
                            </select>
                        </div>
                    </div>
                    <div class="section">
                        <div class="section-title">üì± „Éö„Éº„Ç∏Ë®≠ÂÆö</div>
                        <div class="field">
                            <label class="field-label">ËÉåÊôØËâ≤</label>
                            <div class="color-row">
                                <input type="color" id="pageBgColor" value="#f5f5f5" oninput="updatePreview()">
                                <input type="text" id="pageBgColorText" value="#f5f5f5" oninput="syncColor('pageBgColor', this.value); updatePreview()">
                            </div>
                        </div>
                        <div class="field">
                            <label class="field-label">„Ç´„Éº„Éâ„ÅÆËßí‰∏∏ (px)</label>
                            <input type="number" id="cardBorderRadius" value="12" min="0" max="30" oninput="updatePreview()">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- PREVIEW -->
        <div class="preview-area">
            <div class="preview-frame-wrapper">
                <iframe id="previewFrame"></iframe>
            </div>
            <div class="device-label">390 √ó 844 ‚Äî iPhone 14 Pro</div>
        </div>
    </div>
</div>

<script>
// ===== DATA MODEL =====
let data = {
    header: {
        title: 'Ë¶ãÂá∫„Åó',
        fontSize: 60,
        writingMode: 'vertical-rl',
        color1: '#667eea',
        color2: '#764ba2',
        gradientAngle: 135,
        aspect: 0.75
    },
    accent: '#667eea',
    fontFamily: "'Hiragino Mincho ProN', 'Yu Mincho', 'MS Mincho', serif",
    pageBg: '#f5f5f5',
    cardRadius: 12,
    mainTabs: [
        {
            name: '„Çø„ÉñÔºë',
            titleText: 'Ë¶ãÂá∫„Åó',
            subTabs: [
                {
                    name: '„Åô„Åπ„Å¶',
                    card: { title: '„Åô„Åπ„Å¶„ÅÆ„Ç≥„É≥„ÉÜ„É≥„ÉÑ', text: '„Åì„Åì„Å´„ÅØÂÖ®„Ç´„ÉÜ„Ç¥„É™„Éº„ÅÆ„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÅåË°®Á§∫„Åï„Çå„Åæ„Åô„ÄÇ', colorClass: 'color-orange' },
                    items: [
                        { emoji: 'üì∞', title: 'ÊúÄÊñ∞Ë®ò‰∫ã„Çø„Ç§„Éà„É´', subtitle: '2026Âπ¥2Êúà15Êó•' },
                        { emoji: 'üéØ', title: 'Ê≥®ÁõÆ„ÅÆ„Ç§„Éô„É≥„Éà', subtitle: '2026Âπ¥2Êúà20Êó•ÈñãÂÇ¨' }
                    ]
                },
                {
                    name: '„Éã„É•„Éº„Çπ',
                    card: { title: '„Éã„É•„Éº„Çπ', text: 'ÊúÄÊñ∞„ÅÆ„Éã„É•„Éº„Çπ„ÇÑÊ•≠ÁïåÂãïÂêë„Çí„ÅäÂ±ä„Åë„Åó„Åæ„Åô„ÄÇ', colorClass: 'color-blue' },
                    items: [
                        { emoji: 'üì¢', title: 'ÈÄüÂ†±„Éã„É•„Éº„Çπ', subtitle: 'Êú¨Êó•Êõ¥Êñ∞' }
                    ]
                }
            ]
        },
        {
            name: '„Çø„ÉñÔºí',
            titleText: '‰∫∫Ê∞ó',
            subTabs: [
                {
                    name: '‰∫∫Ê∞ó',
                    card: { title: '‰∫∫Ê∞ó„Ç≥„É≥„ÉÜ„É≥„ÉÑ', text: 'Â§ö„Åè„ÅÆÊñπ„Å´Ë™≠„Åæ„Çå„Å¶„ÅÑ„Çã‰∫∫Ê∞ó„ÅÆË®ò‰∫ã„Çí„ÅîÁ¥π‰ªã„Åó„Åæ„Åô„ÄÇ', colorClass: 'color-blue' },
                    items: [
                        { emoji: 'üî•', title: '‰ªäÈÄ±„ÅÆ‰∫∫Ê∞óË®ò‰∫ãTOP3', subtitle: 'Èñ≤Ë¶ßÊï∞ 15,234' },
                        { emoji: '‚≠ê', title: 'Ë©±È°å„ÅÆÊñ∞„Çµ„Éº„Éì„Çπ', subtitle: 'Èñ≤Ë¶ßÊï∞ 12,890' }
                    ]
                },
                {
                    name: '„Åä„Åô„Åô„ÇÅ',
                    card: { title: '„Åä„Åô„Åô„ÇÅ„Ç≥„É≥„ÉÜ„É≥„ÉÑ', text: '„ÅÇ„Å™„Åü„Å´„Å¥„Å£„Åü„Çä„ÅÆ„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÇíÂé≥ÈÅ∏„Åó„Å¶„ÅäÂ±ä„Åë„Åó„Åæ„Åô„ÄÇ', colorClass: 'color-green' },
                    items: [
                        { emoji: 'üíé', title: 'Á∑®ÈõÜÈÉ®„Åä„Åô„Åô„ÇÅÁâπÈõÜ', subtitle: 'Âé≥ÈÅ∏„Ç≥„É≥„ÉÜ„É≥„ÉÑ' }
                    ]
                }
            ]
        },
        {
            name: '„Çø„ÉñÔºì',
            titleText: 'Ë®≠ÂÆö',
            subTabs: [
                {
                    name: 'Ë®≠ÂÆö',
                    card: { title: 'Âü∫Êú¨Ë®≠ÂÆö', text: '„Ç¢„Éó„É™„ÅÆË°®Á§∫„ÇÑÂãï‰Ωú„Å´Èñ¢„Åô„ÇãË®≠ÂÆö„ÇíÂ§âÊõ¥„Åß„Åç„Åæ„Åô„ÄÇ', colorClass: 'color-green' },
                    items: [
                        { emoji: 'üé®', title: '„ÉÜ„Éº„ÉûË®≠ÂÆö', subtitle: '„É©„Ç§„Éà / „ÉÄ„Éº„ÇØ' },
                        { emoji: 'üåê', title: 'Ë®ÄË™ûË®≠ÂÆö', subtitle: 'Êó•Êú¨Ë™û' }
                    ]
                },
                {
                    name: 'ÈÄöÁü•',
                    card: { title: 'ÈÄöÁü•Ë®≠ÂÆö', text: 'Âèó„ÅëÂèñ„Çä„Åü„ÅÑÈÄöÁü•„ÅÆÁ®ÆÈ°û„ÇíÈÅ∏Êäû„Åß„Åç„Åæ„Åô„ÄÇ', colorClass: 'color-orange' },
                    items: [
                        { emoji: 'üîî', title: '„Éó„ÉÉ„Ç∑„É•ÈÄöÁü•', subtitle: '„Ç™„É≥' }
                    ]
                }
            ]
        }
    ]
};

const EMOJIS = ['üì∞','üéØ','üî•','‚≠ê','üíé','üéÅ','üÜï','üì±','üèÜ','üìä','üì¢','üí°','üìö','üóÇÔ∏è','üé®','üåê','üîî','üìß','üë§','üîí','‚ùì','üí¨','üìù','üéµ','üè†','üí∞','üõí','‚úàÔ∏è','üçΩÔ∏è','‚öôÔ∏è','‚ù§Ô∏è','üåü'];

const CARD_COLORS = [
    { name: '„Ç™„É¨„É≥„Ç∏', class: 'color-orange', gradient: 'linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%)' },
    { name: '„Éñ„É´„Éº', class: 'color-blue', gradient: 'linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%)' },
    { name: '„Ç∞„É™„Éº„É≥', class: 'color-green', gradient: 'linear-gradient(135deg, #d4fc79 0%, #96e6a1 100%)' },
    { name: '„Éî„É≥„ÇØ', class: 'color-pink', gradient: 'linear-gradient(135deg, #fccb90 0%, #d57eeb 100%)' },
    { name: '„Éë„Éº„Éó„É´', class: 'color-purple', gradient: 'linear-gradient(135deg, #e0c3fc 0%, #8ec5fc 100%)' },
    { name: '„Éá„Éï„Ç©„É´„Éà', class: '', gradient: 'linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%)' }
];

const HEADER_PRESETS = [
    ['#667eea', '#764ba2'],
    ['#f093fb', '#f5576c'],
    ['#4facfe', '#00f2fe'],
    ['#43e97b', '#38f9d7'],
    ['#fa709a', '#fee140'],
    ['#a18cd1', '#fbc2eb'],
    ['#fccb90', '#d57eeb'],
    ['#ff9a9e', '#fecfef'],
    ['#2b5876', '#4e4376'],
    ['#0c3483', '#a2b6df'],
    ['#1a1a2e', '#16213e'],
    ['#ee9ca7', '#ffdde1']
];

let selectedMainTab = 0;
let selectedContentMainTab = 0;
let selectedContentSubTab = 0;

// ===== INIT =====
function init() {
    setupSidebarTabs();
    renderHeaderPresets();
    renderMainTabsList();
    renderContentSelectors();
    syncFormFromData();
    updatePreview();
}

function setupSidebarTabs() {
    document.querySelectorAll('.sidebar-tab').forEach(tab => {
        tab.addEventListener('click', () => {
            document.querySelectorAll('.sidebar-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.sidebar-panel').forEach(p => p.classList.remove('active'));
            tab.classList.add('active');
            document.getElementById('panel-' + tab.dataset.panel).classList.add('active');
        });
    });
}

// ===== HEADER PRESETS =====
function renderHeaderPresets() {
    const container = document.getElementById('headerPresets');
    container.innerHTML = HEADER_PRESETS.map((p, i) =>
        `<div class="preset-color" style="background: linear-gradient(135deg, ${p[0]}, ${p[1]})" onclick="applyHeaderPreset(${i})"></div>`
    ).join('');
}

function applyHeaderPreset(index) {
    const [c1, c2] = HEADER_PRESETS[index];
    document.getElementById('headerColor1').value = c1;
    document.getElementById('headerColor1Text').value = c1;
    document.getElementById('headerColor2').value = c2;
    document.getElementById('headerColor2Text').value = c2;
    updatePreview();
}

// ===== COLOR SYNC =====
function syncColor(inputId, value) {
    if (/^#[0-9A-Fa-f]{6}$/.test(value)) {
        document.getElementById(inputId).value = value;
    }
}

// ===== MAIN TABS =====
function renderMainTabsList() {
    const list = document.getElementById('mainTabsList');
    list.innerHTML = data.mainTabs.map((tab, i) =>
        `<div class="edit-list-item ${i === selectedMainTab ? 'selected' : ''}" onclick="selectMainTab(${i})">
            <span class="tab-drag-handle">‚†ø</span>
            <span class="item-label">${tab.name}</span>
            <span class="item-badge">${tab.subTabs.length} „Çµ„Éñ</span>
            <span class="item-delete" onclick="event.stopPropagation(); deleteMainTab(${i})">√ó</span>
        </div>`
    ).join('');
    renderMainTabDetail();
}

function selectMainTab(index) {
    selectedMainTab = index;
    renderMainTabsList();
}

function addMainTab() {
    const n = data.mainTabs.length + 1;
    data.mainTabs.push({
        name: `„Çø„Éñ${n}`,
        titleText: `„Çø„Ç§„Éà„É´${n}`,
        subTabs: [{
            name: 'Êñ∞Ë¶è',
            card: { title: 'Êñ∞„Åó„ÅÑ„Ç≥„É≥„ÉÜ„É≥„ÉÑ', text: '„Ç≥„É≥„ÉÜ„É≥„ÉÑ„ÅÆË™¨ÊòéÊñá„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ', colorClass: '' },
            items: []
        }]
    });
    selectedMainTab = data.mainTabs.length - 1;
    renderMainTabsList();
    renderContentSelectors();
    updatePreview();
}

function deleteMainTab(index) {
    if (data.mainTabs.length <= 1) return alert('ÊúÄ‰Ωé1„Å§„ÅÆ„Çø„Éñ„ÅåÂøÖË¶Å„Åß„Åô');
    data.mainTabs.splice(index, 1);
    if (selectedMainTab >= data.mainTabs.length) selectedMainTab = data.mainTabs.length - 1;
    renderMainTabsList();
    renderContentSelectors();
    updatePreview();
}

function renderMainTabDetail() {
    const tab = data.mainTabs[selectedMainTab];
    if (!tab) return;

    const detail = document.getElementById('mainTabDetail');
    detail.innerHTML = `
        <div class="detail-panel">
            <div class="detail-panel-header">
                <span class="detail-panel-title">„Çø„ÉñË®≠ÂÆö: ${tab.name}</span>
            </div>
            <div class="field">
                <label class="field-label">„Çø„ÉñÂêç</label>
                <input type="text" value="${tab.name}" oninput="data.mainTabs[${selectedMainTab}].name = this.value; renderMainTabsList(); renderContentSelectors(); updatePreview()">
            </div>
            <div class="field">
                <label class="field-label">„Éò„ÉÉ„ÉÄ„Éº„Å´Ë°®Á§∫„Åô„Çã„Çø„Ç§„Éà„É´</label>
                <input type="text" value="${tab.titleText}" oninput="data.mainTabs[${selectedMainTab}].titleText = this.value; updatePreview()">
            </div>
            <div class="section" style="margin-top: 16px;">
                <div class="section-title">„Çµ„Éñ„Çø„Éñ</div>
                <div class="edit-list">
                    ${tab.subTabs.map((st, j) =>
                        `<div class="edit-list-item">
                            <span class="item-label">${st.name}</span>
                            <span class="item-delete" onclick="deleteSubTab(${selectedMainTab}, ${j})">√ó</span>
                        </div>`
                    ).join('')}
                </div>
                <div class="btn-row">
                    <button class="btn btn-primary btn-sm" onclick="addSubTab(${selectedMainTab})">Ôºã „Çµ„Éñ„Çø„ÉñËøΩÂä†</button>
                </div>
            </div>
        </div>
    `;
}

function addSubTab(mainIndex) {
    data.mainTabs[mainIndex].subTabs.push({
        name: 'Êñ∞Ë¶è„Çø„Éñ',
        card: { title: 'Êñ∞„Åó„ÅÑ„Çª„ÇØ„Ç∑„Éß„É≥', text: 'Ë™¨ÊòéÊñá„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ', colorClass: '' },
        items: []
    });
    renderMainTabsList();
    renderContentSelectors();
    updatePreview();
}

function deleteSubTab(mainIndex, subIndex) {
    if (data.mainTabs[mainIndex].subTabs.length <= 1) return alert('ÊúÄ‰Ωé1„Å§„ÅÆ„Çµ„Éñ„Çø„Éñ„ÅåÂøÖË¶Å„Åß„Åô');
    data.mainTabs[mainIndex].subTabs.splice(subIndex, 1);
    renderMainTabsList();
    renderContentSelectors();
    updatePreview();
}

// ===== CONTENT EDITING =====
function renderContentSelectors() {
    const mainSelect = document.getElementById('contentMainTabSelect');
    mainSelect.innerHTML = data.mainTabs.map((t, i) =>
        `<option value="${i}">${t.name}</option>`
    ).join('');
    mainSelect.value = selectedContentMainTab;
    onContentMainTabChange();
}

function onContentMainTabChange() {
    selectedContentMainTab = parseInt(document.getElementById('contentMainTabSelect').value);
    const subSelect = document.getElementById('contentSubTabSelect');
    const tab = data.mainTabs[selectedContentMainTab];
    if (!tab) return;
    subSelect.innerHTML = tab.subTabs.map((st, i) =>
        `<option value="${i}">${st.name}</option>`
    ).join('');
    selectedContentSubTab = 0;
    subSelect.value = 0;
    onContentSubTabChange();
}

function onContentSubTabChange() {
    selectedContentSubTab = parseInt(document.getElementById('contentSubTabSelect').value);
    renderContentEditor();
}

function renderContentEditor() {
    const tab = data.mainTabs[selectedContentMainTab];
    if (!tab) return;
    const sub = tab.subTabs[selectedContentSubTab];
    if (!sub) return;

    const mi = selectedContentMainTab;
    const si = selectedContentSubTab;

    const colorOptions = CARD_COLORS.map(c =>
        `<option value="${c.class}" ${sub.card.colorClass === c.class ? 'selected' : ''}>${c.name}</option>`
    ).join('');

    let html = `
        <div class="section">
            <div class="section-title">üè∑Ô∏è „Çµ„Éñ„Çø„ÉñÂêç</div>
            <div class="field">
                <input type="text" value="${sub.name}" oninput="updateSubTabName(${mi}, ${si}, this.value)">
            </div>
        </div>
        <div class="section">
            <div class="section-title">üÉè „Ç≥„É≥„ÉÜ„É≥„ÉÑ„Ç´„Éº„Éâ</div>
            <div class="field">
                <label class="field-label">„Ç´„Éº„Éâ„Çø„Ç§„Éà„É´</label>
                <input type="text" value="${sub.card.title}" oninput="data.mainTabs[${mi}].subTabs[${si}].card.title = this.value; updatePreview()">
            </div>
            <div class="field">
                <label class="field-label">„Ç´„Éº„ÉâË™¨ÊòéÊñá</label>
                <textarea oninput="data.mainTabs[${mi}].subTabs[${si}].card.text = this.value; updatePreview()">${sub.card.text}</textarea>
            </div>
            <div class="field">
                <label class="field-label">„Ç´„Éº„ÉâËâ≤</label>
                <select onchange="data.mainTabs[${mi}].subTabs[${si}].card.colorClass = this.value; updatePreview()">
                    ${colorOptions}
                </select>
            </div>
        </div>
        <div class="section">
            <div class="section-title">üìã „É™„Çπ„Éà„Ç¢„Ç§„ÉÜ„É†</div>
            <div class="edit-list" id="contentItemsList">
                ${sub.items.map((item, k) => `
                    <div class="edit-list-item" onclick="editContentItem(${mi}, ${si}, ${k})">
                        <span style="font-size:18px; flex-shrink:0;">${item.emoji}</span>
                        <span class="item-label">${item.title}</span>
                        <span class="item-delete" onclick="event.stopPropagation(); deleteContentItem(${mi}, ${si}, ${k})">√ó</span>
                    </div>
                `).join('')}
            </div>
            <div class="btn-row">
                <button class="btn btn-primary btn-sm" onclick="addContentItem(${mi}, ${si})">Ôºã „Ç¢„Ç§„ÉÜ„É†ËøΩÂä†</button>
            </div>
        </div>
        <div id="contentItemDetail"></div>
    `;

    document.getElementById('contentEditor').innerHTML = html;
}

function updateSubTabName(mi, si, value) {
    data.mainTabs[mi].subTabs[si].name = value;
    renderMainTabsList();
    renderContentSelectors();
    document.getElementById('contentMainTabSelect').value = mi;
    onContentMainTabChange();
    document.getElementById('contentSubTabSelect').value = si;
    selectedContentSubTab = si;
    renderContentEditor();
    updatePreview();
}

function addContentItem(mi, si) {
    data.mainTabs[mi].subTabs[si].items.push({
        emoji: 'üìÑ',
        title: 'Êñ∞„Åó„ÅÑ„Ç¢„Ç§„ÉÜ„É†',
        subtitle: '„Çµ„Éñ„ÉÜ„Ç≠„Çπ„Éà'
    });
    renderContentEditor();
    updatePreview();
}

function deleteContentItem(mi, si, ki) {
    data.mainTabs[mi].subTabs[si].items.splice(ki, 1);
    renderContentEditor();
    updatePreview();
}

function editContentItem(mi, si, ki) {
    const item = data.mainTabs[mi].subTabs[si].items[ki];
    const detail = document.getElementById('contentItemDetail');
    const emojiGrid = EMOJIS.map(e =>
        `<span onclick="setItemEmoji(${mi}, ${si}, ${ki}, '${e}')">${e}</span>`
    ).join('');

    detail.innerHTML = `
        <div class="detail-panel">
            <div class="detail-panel-header">
                <span class="detail-panel-title">${item.emoji} „Ç¢„Ç§„ÉÜ„É†Á∑®ÈõÜ</span>
            </div>
            <div class="field">
                <label class="field-label">„Ç¢„Ç§„Ç≥„É≥ÁµµÊñáÂ≠ó</label>
                <div class="emoji-grid">${emojiGrid}</div>
            </div>
            <div class="field">
                <label class="field-label">„Çø„Ç§„Éà„É´</label>
                <input type="text" value="${item.title}" oninput="data.mainTabs[${mi}].subTabs[${si}].items[${ki}].title = this.value; updatePreview()">
            </div>
            <div class="field">
                <label class="field-label">„Çµ„Éñ„ÉÜ„Ç≠„Çπ„Éà</label>
                <input type="text" value="${item.subtitle}" oninput="data.mainTabs[${mi}].subTabs[${si}].items[${ki}].subtitle = this.value; updatePreview()">
            </div>
        </div>
    `;
}

function setItemEmoji(mi, si, ki, emoji) {
    data.mainTabs[mi].subTabs[si].items[ki].emoji = emoji;
    renderContentEditor();
    editContentItem(mi, si, ki);
    updatePreview();
}

// ===== SYNC FORM ‚Üí DATA =====
function syncFormFromData() {
    document.getElementById('headerTitle').value = data.header.title;
    document.getElementById('headerFontSize').value = data.header.fontSize;
    document.getElementById('headerWritingMode').value = data.header.writingMode;
    document.getElementById('headerColor1').value = data.header.color1;
    document.getElementById('headerColor1Text').value = data.header.color1;
    document.getElementById('headerColor2').value = data.header.color2;
    document.getElementById('headerColor2Text').value = data.header.color2;
    document.getElementById('headerGradientAngle').value = data.header.gradientAngle;
    document.getElementById('headerAspect').value = data.header.aspect;
    document.getElementById('accentColor').value = data.accent;
    document.getElementById('accentColorText').value = data.accent;
    document.getElementById('pageBgColor').value = data.pageBg;
    document.getElementById('pageBgColorText').value = data.pageBg;
    document.getElementById('cardBorderRadius').value = data.cardRadius;
}

function syncDataFromForm() {
    data.header.title = document.getElementById('headerTitle').value;
    data.header.fontSize = parseInt(document.getElementById('headerFontSize').value) || 60;
    data.header.writingMode = document.getElementById('headerWritingMode').value;
    data.header.color1 = document.getElementById('headerColor1').value;
    data.header.color2 = document.getElementById('headerColor2').value;
    data.header.gradientAngle = parseInt(document.getElementById('headerGradientAngle').value) || 135;
    data.header.aspect = parseFloat(document.getElementById('headerAspect').value) || 0.75;
    data.accent = document.getElementById('accentColor').value;
    data.fontFamily = document.getElementById('fontFamily').value;
    data.pageBg = document.getElementById('pageBgColor').value;
    data.cardRadius = parseInt(document.getElementById('cardBorderRadius').value) || 12;

    // sync text inputs
    document.getElementById('headerColor1Text').value = data.header.color1;
    document.getElementById('headerColor2Text').value = data.header.color2;
    document.getElementById('accentColorText').value = data.accent;
    document.getElementById('pageBgColorText').value = data.pageBg;

    // gradient preview
    document.getElementById('headerGradientPreview').style.background =
        `linear-gradient(${data.header.gradientAngle}deg, ${data.header.color1}, ${data.header.color2})`;
}

// ===== GENERATE HTML =====
function generateHTML() {
    syncDataFromForm();
    const d = data;
    const accent = d.accent;

    // Build slides HTML
    let slidesHTML = '';
    let mainTabsHTML = '';
    let indicatorsHTML = '';

    d.mainTabs.forEach((tab, i) => {
        mainTabsHTML += `        <div class="main-tab${i === 0 ? ' active' : ''}" data-tab="${i}" data-title="${escapeHtml(tab.titleText)}">${escapeHtml(tab.name)}</div>\n`;
        indicatorsHTML += `            <div class="indicator${i === 0 ? ' active' : ''}" data-slide="${i}"></div>\n`;

        let subTabsHTML = '';
        let subContentsHTML = '';

        tab.subTabs.forEach((st, j) => {
            subTabsHTML += `                    <div class="subtab${j === 0 ? ' active' : ''}" data-slide="${i}" data-subtab="${j}">${escapeHtml(st.name)}</div>\n`;

            let itemsHTML = '';
            st.items.forEach(item => {
                itemsHTML += `                            <div class="content-list-item">
                                <div class="list-icon">${item.emoji}</div>
                                <div class="list-content">
                                    <div class="list-title">${escapeHtml(item.title)}</div>
                                    <div class="list-subtitle">${escapeHtml(item.subtitle)}</div>
                                </div>
                                <div class="list-arrow">‚Ä∫</div>
                            </div>\n`;
            });

            subContentsHTML += `                    <div class="subtab-content${j === 0 ? ' active' : ''}" data-slide="${i}" data-content="${j}">
                        <div class="content-card ${st.card.colorClass}">
                            <div class="content-card-title">${escapeHtml(st.card.title)}</div>
                            <div class="content-card-text">${escapeHtml(st.card.text)}</div>
                        </div>
                        <div class="content-list">
${itemsHTML}                        </div>
                    </div>\n`;
        });

        slidesHTML += `            <div class="carousel-slide${i === 0 ? ' active' : ''}">
                <div class="subtabs-container" id="subtabs-${i}">
${subTabsHTML}                </div>
                <div class="subtab-content-wrapper">
${subContentsHTML}                </div>
            </div>\n`;
    });

    return `<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„É¢„Éê„Ç§„É´„Éö„Éº„Ç∏</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: ${d.fontFamily};
            background-color: ${d.pageBg};
            max-width: 100%;
            overflow-x: hidden;
        }
        @media (min-width: 768px) {
            body { display: flex; flex-direction: column; align-items: center; }
            .header-grid, .main-tabs-container, .carousel-container { max-width: 768px; }
            .header-grid { width: 768px; }
        }
        .header-grid {
            width: 100vw;
            height: ${d.header.aspect * 100}vw;
            background: linear-gradient(${d.header.gradientAngle}deg, ${d.header.color1} 0%, ${d.header.color2} 100%);
            display: flex;
            justify-content: center;
            align-items: flex-end;
            padding-bottom: 30px;
            position: relative;
        }
        .vertical-title {
            writing-mode: ${d.header.writingMode};
            font-size: ${d.header.fontSize}px;
            color: white;
            font-weight: bold;
            letter-spacing: 0.1em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            transition: opacity 0.3s ease;
        }
        @media (min-width: 768px) { .vertical-title { font-size: ${Math.round(d.header.fontSize * 1.5)}px; } }
        @media (min-width: 1024px) {
            .vertical-title { font-size: ${Math.round(d.header.fontSize * 2)}px; }
            .header-grid { height: 60vw; max-height: 600px; }
        }
        .main-tabs-container { display: flex; background-color: white; border-bottom: 2px solid #e0e0e0; }
        .main-tab {
            flex: 1; padding: 16px; text-align: center; font-size: 16px; font-weight: bold;
            cursor: pointer; border-bottom: 3px solid transparent; transition: all 0.3s ease; background-color: white;
        }
        .main-tab.active { color: ${accent}; border-bottom-color: ${accent}; background-color: #f9f9ff; }
        .main-tab:hover { background-color: #f5f5f5; }
        .carousel-container { position: relative; background-color: white; }
        .carousel-wrapper { display: flex; }
        .carousel-slide { min-width: 100%; display: none; }
        .carousel-slide.active { display: block; }
        .subtabs-container {
            display: flex; background: white; padding: 16px 20px; gap: 10px;
            overflow-x: auto; -webkit-overflow-scrolling: touch; scrollbar-width: none; border-bottom: 1px solid #f0f0f0;
        }
        .subtabs-container::-webkit-scrollbar { display: none; }
        .subtab {
            padding: 10px 24px; border-radius: 20px; background: #f0f0f0; color: #666;
            font-size: 14px; white-space: nowrap; cursor: pointer; transition: all 0.3s ease; flex-shrink: 0;
        }
        .subtab.active { background: ${accent}; color: white; box-shadow: 0 2px 8px ${accent}4d; }
        .subtab:active { transform: scale(0.95); }
        .subtab-content-wrapper { background: white; }
        .subtab-content { display: none; padding: 24px 20px; animation: fadeIn 0.3s ease; }
        .subtab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .content-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: ${d.cardRadius}px; padding: 30px 20px; margin-bottom: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .content-card-title { font-size: 20px; font-weight: bold; color: #333; margin-bottom: 12px; }
        .content-card-text { font-size: 15px; color: #555; line-height: 1.8; }
        .content-list { background: white; }
        .content-list-item { display: flex; align-items: center; padding: 16px 0; border-bottom: 1px solid #f0f0f0; }
        .content-list-item:last-child { border-bottom: none; }
        .list-icon {
            width: 50px; height: 50px; background: linear-gradient(135deg, ${accent}, ${d.header.color2});
            border-radius: 10px; display: flex; align-items: center; justify-content: center;
            font-size: 24px; margin-right: 16px; flex-shrink: 0;
        }
        .list-content { flex: 1; }
        .list-title { font-size: 16px; font-weight: bold; color: #333; margin-bottom: 4px; }
        .list-subtitle { font-size: 13px; color: #999; }
        .list-arrow { color: #ccc; font-size: 24px; margin-left: 8px; }
        .carousel-indicators { display: flex; justify-content: center; padding: 20px; gap: 10px; background: white; }
        .indicator { width: 10px; height: 10px; border-radius: 50%; background-color: #ddd; cursor: pointer; transition: all 0.3s ease; }
        .indicator.active { background-color: ${accent}; width: 30px; border-radius: 5px; }
        .carousel-nav {
            position: absolute; top: 50%; transform: translateY(-50%); background-color: rgba(255,255,255,0.95);
            border: none; width: 44px; height: 44px; border-radius: 50%; font-size: 24px; cursor: pointer;
            display: flex; justify-content: center; align-items: center; box-shadow: 0 2px 12px rgba(0,0,0,0.15); z-index: 10; transition: all 0.2s;
        }
        .carousel-nav:active { transform: translateY(-50%) scale(0.9); }
        .carousel-nav.prev { left: 10px; }
        .carousel-nav.next { right: 10px; }
        .color-orange { background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%); }
        .color-blue { background: linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%); }
        .color-green { background: linear-gradient(135deg, #d4fc79 0%, #96e6a1 100%); }
        .color-pink { background: linear-gradient(135deg, #fccb90 0%, #d57eeb 100%); }
        .color-purple { background: linear-gradient(135deg, #e0c3fc 0%, #8ec5fc 100%); }
    </style>
</head>
<body>
    <div class="header-grid">
        <h1 class="vertical-title" id="main-title">${escapeHtml(d.mainTabs[0]?.titleText || d.header.title)}</h1>
    </div>

    <div class="main-tabs-container">
${mainTabsHTML}    </div>

    <div class="carousel-container">
        <button class="carousel-nav prev" onclick="changeMainSlide(-1)">‚Äπ</button>
        <button class="carousel-nav next" onclick="changeMainSlide(1)">‚Ä∫</button>
        <div class="carousel-wrapper">
${slidesHTML}        </div>
        <div class="carousel-indicators">
${indicatorsHTML}        </div>
    </div>

    <script>
        let currentMainSlide = 0;
        const mainSlides = document.querySelectorAll('.carousel-slide');
        const mainTabs = document.querySelectorAll('.main-tab');
        const indicators = document.querySelectorAll('.indicator');
        const currentSubTabs = [${d.mainTabs.map(() => '0').join(', ')}];

        mainTabs.forEach((tab, index) => { tab.addEventListener('click', () => goToMainSlide(index)); });
        indicators.forEach((ind, index) => { ind.addEventListener('click', () => goToMainSlide(index)); });
        document.querySelectorAll('.subtab').forEach(subtab => {
            subtab.addEventListener('click', function() {
                goToSubTab(parseInt(this.dataset.slide), parseInt(this.dataset.subtab));
            });
        });

        function changeMainSlide(direction) {
            let n = currentMainSlide + direction;
            if (n < 0) n = mainSlides.length - 1;
            if (n >= mainSlides.length) n = 0;
            goToMainSlide(n);
        }

        function goToMainSlide(index) {
            mainSlides[currentMainSlide].classList.remove('active');
            mainTabs[currentMainSlide].classList.remove('active');
            indicators[currentMainSlide].classList.remove('active');
            currentMainSlide = index;
            mainSlides[index].classList.add('active');
            mainTabs[index].classList.add('active');
            indicators[index].classList.add('active');
            const mainTitle = document.getElementById('main-title');
            mainTitle.style.opacity = '0';
            setTimeout(() => {
                mainTitle.textContent = mainTabs[index].dataset.title;
                mainTitle.style.opacity = '1';
            }, 300);
        }

        function goToSubTab(slideIndex, subtabIndex) {
            const subtabs = document.querySelectorAll('.subtab[data-slide="' + slideIndex + '"]');
            const contents = document.querySelectorAll('.subtab-content[data-slide="' + slideIndex + '"]');
            subtabs[currentSubTabs[slideIndex]].classList.remove('active');
            contents[currentSubTabs[slideIndex]].classList.remove('active');
            currentSubTabs[slideIndex] = subtabIndex;
            subtabs[subtabIndex].classList.add('active');
            contents[subtabIndex].classList.add('active');
            const container = document.getElementById('subtabs-' + slideIndex);
            const active = subtabs[subtabIndex];
            container.scrollTo({ left: active.offsetLeft - container.offsetWidth / 2 + active.offsetWidth / 2, behavior: 'smooth' });
        }

        let touchStartX = 0, touchEndX = 0;
        const cc = document.querySelector('.carousel-container');
        cc.addEventListener('touchstart', e => { touchStartX = e.changedTouches[0].screenX; });
        cc.addEventListener('touchend', e => {
            touchEndX = e.changedTouches[0].screenX;
            const diff = touchEndX - touchStartX;
            if (diff < -50) changeMainSlide(1);
            if (diff > 50) changeMainSlide(-1);
        });
    <\/script>
</body>
</html>`;
}

function escapeHtml(str) {
    const div = document.createElement('div');
    div.textContent = str;
    return div.innerHTML;
}

// ===== PREVIEW =====
let previewTimeout;
function updatePreview() {
    clearTimeout(previewTimeout);
    previewTimeout = setTimeout(() => {
        const html = generateHTML();
        const iframe = document.getElementById('previewFrame');
        const doc = iframe.contentDocument || iframe.contentWindow.document;
        doc.open();
        doc.write(html);
        doc.close();
    }, 150);
}

// ===== EXPORT =====
function exportHTML() {
    const html = generateHTML();
    const blob = new Blob([html], { type: 'text/html' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'mobile_page.html';
    a.click();
    URL.revokeObjectURL(a.href);
}

function exportJSON() {
    syncDataFromForm();
    const json = JSON.stringify(data, null, 2);
    const blob = new Blob([json], { type: 'application/json' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'page_data.json';
    a.click();
    URL.revokeObjectURL(a.href);
}

function importJSON() {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.json';
    input.onchange = e => {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = ev => {
            try {
                data = JSON.parse(ev.target.result);
                selectedMainTab = 0;
                selectedContentMainTab = 0;
                selectedContentSubTab = 0;
                syncFormFromData();
                renderMainTabsList();
                renderContentSelectors();
                updatePreview();
            } catch (err) {
                alert('JSON„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ' + err.message);
            }
        };
        reader.readAsText(file);
    };
    input.click();
}

function resetAll() {
    if (!confirm('„Åô„Åπ„Å¶„ÅÆ„Éá„Éº„Çø„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åô„ÅãÔºü')) return;
    location.reload();
}

// ===== START =====
init();
</script>
</body>
</html>
